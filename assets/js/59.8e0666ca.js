(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{444:function(e,s,t){"use strict";t.r(s);var n=t(54),a=Object(n.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"code-quality-and-continuous-integration"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#code-quality-and-continuous-integration"}},[e._v("#")]),e._v(" Code quality and continuous integration")]),e._v(" "),t("h2",{attrs:{id:"using-the-manage-tool"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#using-the-manage-tool"}},[e._v("#")]),e._v(" Using the manage tool")]),e._v(" "),t("p",[e._v("Before making a pull request with changes to this library, please ensure that style checks passes, that the code compiles,\nunit test passes and that there are no erros found by the static analyser.")]),e._v(" "),t("p",[e._v("To setup the CI environment, run following commands")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("virtualenv develop__venv\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("source")]),e._v(" develop__venv/bin/activate\npip "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" -r requirements.txt\n")])])]),t("p",[e._v("These adds the necessary environment variables to ensure that you have the "),t("code",[e._v("tasks_ci")]),e._v(" package and all required dependencies.")]),e._v(" "),t("p",[e._v("To check the style, run")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("./manage stylecheck\n")])])]),t("p",[e._v("To test that the code compiles and tests passes run")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("./manage "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("test")]),e._v("\n")])])]),t("p",[e._v("Finally, to analyse the code, run")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("./manage lint\n")])])]),t("p",[e._v("You can run all processes by running:")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("./manage runci\n")])])]),t("p",[e._v("As "),t("code",[e._v("clang-tidy")]),e._v(" and "),t("code",[e._v("clang-format")]),e._v(" acts slightly different from version to version and on different platforms, it is recommended\nthat you use a docker image to perform these steps. TODO(TFR): The docker image is not added yet and this will be documented in the future.")]),e._v(" "),t("h2",{attrs:{id:"running-tests"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#running-tests"}},[e._v("#")]),e._v(" Running tests")]),e._v(" "),t("p",[e._v("In order to run the tests, you first need to build the library. Assuming that this is already done and the corresponding build is in "),t("code",[e._v("Debug/")]),e._v(", run the tests from the "),t("code",[e._v("Debug")]),e._v(" folder:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("lit tests/ -v\n-- Testing: 2 tests, 2 workers --\nPASS: Quantum-Passes :: QirAllocationAnalysis/case1.ll (1 of 2)\nPASS: Quantum-Passes :: QirAllocationAnalysis/case2.ll (2 of 2)\n\nTesting Time: 0.27s\n  Passed: 2\n")])])]),t("p",[e._v("The C++ test suite can also be ran from the debug by first building all targets:")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("cmake "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("make")]),e._v("\n")])])]),t("p",[e._v("and then running following command:")]),e._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[e._v("ctest\n")])])]),t("h2",{attrs:{id:"writing-c-tests"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#writing-c-tests"}},[e._v("#")]),e._v(" Writing C++ tests")]),e._v(" "),t("p",[e._v("TODO(tfr): Write this section")]),e._v(" "),t("h2",{attrs:{id:"modifying-code-quality-requirements"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#modifying-code-quality-requirements"}},[e._v("#")]),e._v(" Modifying code quality requirements")]),e._v(" "),t("p",[e._v("The continuous integration component includes:")]),e._v(" "),t("ol",[t("li",[e._v("Style formatting to ensure that everything looks the same. This includes checking that relevant copyrights are in place.")]),e._v(" "),t("li",[e._v("Static analysis")]),e._v(" "),t("li",[e._v("Unit testing")])]),e._v(" "),t("p",[e._v("The automatic style enforcement is configurable with the ability to easily add or remove rules. Currently the source pipelines are defined as:")]),e._v(" "),t("div",{staticClass:"language-python extra-class"},[t("pre",{pre:!0,attrs:{class:"language-python"}},[t("code",[e._v("SOURCE_PIPELINES "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"C++ Main"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"src"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" path"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("join"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("PROJECT_ROOT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Source"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"pipelines"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"hpp"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n                require_pragma_once"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                enforce_cpp_license"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                enforce_formatting\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n            "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"cpp"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("\n                enforce_cpp_license"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n                enforce_formatting\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# ...")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n")])])]),t("p",[e._v("This part defines pipelines for "),t("code",[e._v(".hpp")]),e._v(" files and "),t("code",[e._v(".cpp")]),e._v(" files allowing the developer to add such requirements as having copyright in the op of the source file and ensure that formatting follows that given by "),t("code",[e._v(".clang-format")]),e._v(".")]),e._v(" "),t("p",[e._v("Each of these CI stages can be executed individually using "),t("code",[e._v("./manage")]),e._v(" or you can run the entire CI process by invoking "),t("code",[e._v("./manage runci")]),e._v(". An example of what this may look like is here:")]),e._v(" "),t("div",{staticClass:"language-zsh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("./manage runci\n\n2021-07-21 14:38:04,896 - FormatChecker - ERROR - /Users/tfr/Documents/Projects/qsharp-compiler/src/QsPasses/src/OpsCounter/OpsCounter.cpp was not correctly formatted.\n2021-07-21 14:38:04,899 - FormatChecker - ERROR - Your code did not pass formatting.\n\n./manage stylecheck --fix-issues\n./manage runci\n\n-- Found LLVM 11.1.0\n-- Using LLVMConfig.cmake in: /usr/local/opt/llvm@11/lib/cmake/llvm\n-- Configuring done\n-- Generating done\n-- Build files have been written to: /Users/tfr/Documents/Projects/qsharp-compiler/src/QsPasses/Debug\nConsolidate compiler generated dependencies of target QSharpPasses\n[ 50%] Building CXX object CMakeFiles/QSharpPasses.dir/src/OpsCounter/OpsCounter.cpp.o\n[100%] Linking CXX shared library libQSharpPasses.dylib\nld: warning: directory not found for option '-L/usr/local/opt/llvm/lib'\n[100%] Built target QSharpPasses\n/Users/tfr/Documents/Projects/qsharp-compiler/src/QsPasses/src/OpsCounter/OpsCounter.cpp:29:7: error: invalid case style for class 'LegacyOpsCounterPass' [readability-identifier-naming,-warnings-as-errors]\nclass LegacyOpsCounterPass : public FunctionPass\n      ^~~~~~~~~~~~~~~~~~~~\n      CLegacyOpsCounterPass\n113345 warnings generated.\nSuppressed 113345 warnings (113344 in non-user code, 1 NOLINT).\nUse -header-filter=.* to display errors from all non-system headers. Use -system-headers to display errors from system headers as well.\n1 warning treated as error\n2021-07-21 14:38:40,191 - Linter - ERROR - /Users/tfr/Documents/Projects/qsharp-compiler/src/QsPasses/src/OpsCounter/OpsCounter.cpp failed static analysis\n\n# ISSUES FIXED MANUALLY\n./manage runci\n\n-- Found LLVM 11.1.0\n-- Using LLVMConfig.cmake in: /usr/local/opt/llvm@11/lib/cmake/llvm\n-- Configuring done\n-- Generating done\n-- Build files have been written to: /Users/tfr/Documents/Projects/qsharp-compiler/src/QsPasses/Debug\nConsolidate compiler generated dependencies of target QSharpPasses\n[ 50%] Building CXX object CMakeFiles/QSharpPasses.dir/src/OpsCounter/OpsCounter.cpp.o\n[100%] Linking CXX shared library libQSharpPasses.dylib\nld: warning: directory not found for option '-L/usr/local/opt/llvm/lib'\n[100%] Built target QSharpPasses\n-- Found LLVM 11.1.0\n-- Using LLVMConfig.cmake in: /usr/local/opt/llvm@11/lib/cmake/llvm\n-- Configuring done\n-- Generating done\n-- Build files have been written to: /Users/tfr/Documents/Projects/qsharp-compiler/src/QsPasses/Debug\nConsolidate compiler generated dependencies of target QSharpPasses\n[100%] Built target QSharpPasses\n*********************************\nNo test configuration file found!\n*********************************\n")])])]),t("p",[e._v("The key idea here is to make it extremely easy to be compliant with the style guide, correct any issues that might come as a result of static analysis and at the same time enforce this when a PR is made.")])])}),[],!1,null,null,null);s.default=a.exports}}]);